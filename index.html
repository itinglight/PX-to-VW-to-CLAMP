<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./favicon.svg" type="image/svg+xml">
    <title>PX-to-VW-to-CLAMP Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.10.2/dist/full.min.css" rel="stylesheet" type="text/css" />
    <style>
        /* ç¡®ä¿è¾“å…¥æ¡†ä¸æ˜¾ç¤ºæ•°å­—ç®­å¤´ */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        /* æé«˜è¾“å…¥æ¡†æ–‡å­—å¯¹æ¯”åº¦ */
        .high-contrast-input {
            background-color: white !important;
            /* å¼ºåˆ¶æµ…è‰²èƒŒæ™¯ */
            color: #1f2937 !important;
            /* å¼ºåˆ¶æ·±è‰²æ–‡å­— */
            /* å¢åŠ å³ä¾§å†…è¾¹è·ï¼Œç»™å•ä½ç•™å‡ºç©ºé—´ */
            padding-right: 3.5rem !important;
        }

        /* å¤åˆ¶/Hover æ ·å¼ */
        .copyable-result,
        .copyable-cell {
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .copyable-result:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .copyable-cell:hover {
            background-color: #3b82f61a;
            /* è½»å¾®çš„è“è‰²æ‚¬åœæ•ˆæœ */
        }

        /* è‡ªå®šä¹‰å•ä½æ ·å¼ï¼Œä½¿å…¶çœ‹èµ·æ¥åœ¨è¾“å…¥æ¡†å†…éƒ¨å³ä¾§ */
        .input-unit {
            position: absolute;
            right: 0.75rem;
            /* åŒ¹é… input-group çš„é»˜è®¤å†…è¾¹è· */
            top: 50%;
            transform: translateY(-50%);
            font-weight: bold;
            opacity: 0.6;
            pointer-events: none;
            /* ç¡®ä¿ä¸å½±å“è¾“å…¥æ¡†ç‚¹å‡» */
        }
    </style>
</head>

<body class="bg-base-100 min-h-screen relative">

    <div id="toast-message"
        class="toast toast-top toast-center z-50 opacity-0 transition-opacity duration-300 pointer-events-none w-full max-w-sm">
        <div class="alert alert-success shadow-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span id="toast-text">å·²å¤åˆ¶ï¼</span>
        </div>
    </div>

    <div id="app" class="flex flex-col items-center py-12 px-4">

        <header class="w-full max-w-4xl flex justify-end mb-6">
            <div class="flex items-center space-x-2">
                <span class="text-sm opacity-70">â˜€ï¸ Light</span>
                <input type="checkbox" id="theme-toggle" class="toggle toggle-primary" onclick="toggleTheme()"
                    checked />
                <span class="text-sm opacity-70">ğŸŒ™ Dark</span>
            </div>
        </header>

        <div class="w-full max-w-4xl">

            <h1 class="text-5xl font-extrabold text-primary mb-12 text-center tracking-tight">
                âœ¨ PX-to-VW-to-CLAMP Pro
            </h1>

            <div class="card bg-base-200 shadow-xl mb-10 p-6">
                <h2 class="card-title text-2xl mb-4">âš™ï¸ é…ç½®é¡¹</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">è®¾è®¡ç¨¿å®½åº¦</span>
                        </label>
                        <div class="relative w-full">
                            <input id="design-width-input" type="number" placeholder="é»˜è®¤ 1920"
                                class="input input-bordered w-full text-lg high-contrast-input" min="100" value="1920"
                                onchange="saveConfig()" />
                            <span class="input-unit text-primary">PX</span>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">å°ºå¯¸å·²ä¿å­˜ï¼š<strong id="saved-width-display">1920px</strong></p>
                    </div>

                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">CLAMP æœ€å°ç¼©æ”¾æ¯”ä¾‹</span>
                        </label>
                        <div class="relative w-full">
                            <input id="min-scale-input" type="number" placeholder="é»˜è®¤ 80"
                                class="input input-bordered w-full text-lg high-contrast-input" min="10" max="100"
                                value="80" onchange="saveConfig()" />
                            <span class="input-unit text-accent">%</span>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">æœ€å°å°ºå¯¸ = PX * <strong id="saved-scale-display">80%</strong>
                        </p>
                    </div>
                </div>
            </div>

            <div class="card bg-primary shadow-2xl text-primary-content p-8 mb-10">
                <h2 class="card-title text-3xl mb-6">ğŸ’¡ PX å®æ—¶è½¬æ¢</h2>

                <div class="form-control w-full mb-6">
                    <label class="label">
                        <span class="label-text text-primary-content">è¾“å…¥ PX å€¼</span>
                    </label>
                    <div class="relative w-full">
                        <input id="px-input" type="number" placeholder="ä¾‹å¦‚ 120"
                            class="input input-bordered input-lg w-full text-xl high-contrast-input" min="0"
                            oninput="updateConversion()" />
                        <span class="input-unit text-accent text-lg">PX</span>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

                    <div id="vw-result-container"
                        class="text-center bg-base-100 text-base-content p-4 rounded-lg shadow-inner copyable-result tooltip tooltip-bottom"
                        data-tip="ç‚¹å‡»å¤åˆ¶ VW å€¼" onclick="copyResult('calculated-vw')">
                        <p class="text-sm opacity-80">VW å€¼ (åŸºäº <span id="current-design-width">1920</span>px)</p>
                        <p class="text-3xl font-black mt-1 break-all">
                            <span id="calculated-vw">0.0000vw</span>
                        </p>
                    </div>

                    <div id="clamp-result-container"
                        class="text-center bg-base-100 text-base-content p-4 rounded-lg shadow-inner copyable-result tooltip tooltip-bottom"
                        data-tip="ç‚¹å‡»å¤åˆ¶ CLAMP è¡¨è¾¾å¼" onclick="copyResult('calculated-clamp')">
                        <p class="text-sm opacity-80">CLAMP è¡¨è¾¾å¼ (Min: <span id="current-min-scale">80%</span>, Max:
                            <span id="current-max-px">120px</span>)
                        </p>
                        <p class="text-3xl font-black mt-1 break-all text-warning">
                            <span id="calculated-clamp">clamp(0px, 0vw, 0px)</span>
                        </p>
                    </div>
                </div>
            </div>

            <div class="card bg-base-100 shadow-xl p-6">
                <h2 class="card-title text-2xl mb-4">ğŸ“‹ å¸¸ç”¨å°ºå¯¸å¯¹ç…§è¡¨</h2>
                <div class="overflow-x-auto">
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="px-list-grid">
                    </div>
                </div>
            </div>

            <footer class="footer footer-center p-4 text-base-content mt-12">
                <aside>
                    <p>
                        Built by
                        <a href="https://github.com/itinglight" target="_blank"
                            class="link link-hover font-bold text-primary">itinglight</a>.
                        Simplified PX-to-VW-to-CLAMP Tool.
                    </p>
                </aside>
            </footer>

        </div>
    </div>

    <script>
        const DESIGN_WIDTH_KEY = 'px-to-vw-design-width';
        const MIN_SCALE_KEY = 'px-to-vw-min-scale';
        const THEME_KEY = 'app-theme';
        const DEFAULT_WIDTH = 1920;
        const DEFAULT_SCALE = 80;

        const PX_LIST = [
            12, 14, 16, 18, 20, 24, 28, 32, 36, 40, 48, 56, 64, 72, 96, 128, 160, 200
        ];

        // DOM å…ƒç´ å¼•ç”¨
        const htmlElement = document.documentElement;
        const themeToggle = document.getElementById('theme-toggle');
        const designWidthInput = document.getElementById('design-width-input');
        const minScaleInput = document.getElementById('min-scale-input');
        const savedWidthDisplay = document.getElementById('saved-width-display');
        const savedScaleDisplay = document.getElementById('saved-scale-display');
        const pxInput = document.getElementById('px-input');

        const calculatedVwDisplay = document.getElementById('calculated-vw');
        const calculatedClampDisplay = document.getElementById('calculated-clamp');

        const currentDesignWidthDisplay = document.getElementById('current-design-width');
        const currentMinScaleDisplay = document.getElementById('current-min-scale');
        const currentMaxPxDisplay = document.getElementById('current-max-px');

        const pxListGrid = document.getElementById('px-list-grid');
        const toastMessage = document.getElementById('toast-message');
        const toastText = document.getElementById('toast-text');

        let updateTimeout;
        let copyTimeoutId;

        // --- æ ¸å¿ƒè®¡ç®—å‡½æ•° ---

        function calculateVw(pxValue, width) {
            const px = parseFloat(pxValue);
            const w = parseFloat(width);
            if (isNaN(px) || px <= 0 || isNaN(w) || w <= 0) {
                return '0.0000';
            }
            return ((px / w) * 100).toFixed(4);
        }

        function calculateClamp(pxValue, width, scale) {
            const px = parseFloat(pxValue);
            const w = parseFloat(width);
            const s = parseFloat(scale) / 100;

            if (isNaN(px) || px <= 0 || isNaN(w) || w <= 0 || isNaN(s)) {
                return 'clamp(0px, 0vw, 0px)';
            }

            const vw = calculateVw(px, w);
            const minPx = (px * s).toFixed(2);

            return `clamp(${minPx}px, ${vw}vw, ${px}px)`;
        }

        // --- ä¸»é¢˜åˆ‡æ¢ ---

        function loadTheme() {
            const savedTheme = localStorage.getItem(THEME_KEY);
            const isDark = savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches);

            htmlElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
            themeToggle.checked = isDark;
        }

        function toggleTheme() {
            const isDark = htmlElement.getAttribute('data-theme') === 'dark';
            const newTheme = isDark ? 'light' : 'dark';

            htmlElement.setAttribute('data-theme', newTheme);
            localStorage.setItem(THEME_KEY, newTheme);
        }

        // --- é…ç½®å’Œæ¸²æŸ“é€»è¾‘ ---

        function saveConfig() {
            let designWidth = parseFloat(designWidthInput.value);
            let minScale = parseFloat(minScaleInput.value);

            if (isNaN(designWidth) || designWidth <= 0) {
                designWidth = DEFAULT_WIDTH;
                designWidthInput.value = DEFAULT_WIDTH;
            }
            if (isNaN(minScale) || minScale < 10 || minScale > 100) {
                minScale = DEFAULT_SCALE;
                minScaleInput.value = DEFAULT_SCALE;
            }

            localStorage.setItem(DESIGN_WIDTH_KEY, designWidth.toString());
            localStorage.setItem(MIN_SCALE_KEY, minScale.toString());

            savedWidthDisplay.textContent = `${designWidth}px`;
            savedScaleDisplay.textContent = `${minScale}%`;
            currentDesignWidthDisplay.textContent = designWidth;
            currentMinScaleDisplay.textContent = `${minScale}%`;

            updateConversion();
            renderPxList();
        }

        function updateConversion() {
            const px = pxInput.value;
            const designWidth = parseFloat(designWidthInput.value);
            const minScale = parseFloat(minScaleInput.value);

            currentMaxPxDisplay.textContent = `${px}px`;

            const vw = calculateVw(px, designWidth);
            calculatedVwDisplay.textContent = `${vw}vw`;

            const clamp = calculateClamp(px, designWidth, minScale);
            calculatedClampDisplay.textContent = clamp;
        }

        function renderPxList() {
            const designWidth = parseFloat(designWidthInput.value);
            const minScale = parseFloat(minScaleInput.value);
            let html = '';

            PX_LIST.forEach(px => {
                const vw = calculateVw(px, designWidth);
                const clamp = calculateClamp(px, designWidth, minScale);
                const vwId = `list-vw-${px}`;
                const clampId = `list-clamp-${px}`;

                html += `
                    <div class="card bg-base-300 shadow-md p-4 space-y-2">
                        <p class="text-sm opacity-70">åŸå§‹ PX: <span class="font-mono text-primary font-bold">${px}px</span></p>
                        
                        <div class="copyable-cell rounded-md p-2 hover:bg-info-content/10" data-tip="ç‚¹å‡»å¤åˆ¶ VW" onclick="copyResult('${vwId}', 'vw')">
                            <p class="text-xs opacity-70">VW</p>
                            <p class="text-lg font-bold break-all text-info">
                                <span id="${vwId}">${vw}vw</span>
                            </p>
                        </div>
                        
                        <div class="copyable-cell rounded-md p-2 hover:bg-warning-content/10" data-tip="ç‚¹å‡»å¤åˆ¶ CLAMP" onclick="copyResult('${clampId}', 'clamp')">
                            <p class="text-xs opacity-70">CLAMP</p>
                            <p class="text-md font-medium break-all text-warning">
                                <span id="${clampId}">${clamp}</span>
                            </p>
                        </div>
                    </div>
                `;
            });
            pxListGrid.innerHTML = html;
        }

        // --- å¤åˆ¶åŠŸèƒ½ ---

        function copyResult(elementId, type = 'value') {
            const contentElement = document.getElementById(elementId);
            const content = contentElement.textContent;

            navigator.clipboard.writeText(content).then(() => {
                // 1. è®¾ç½®æç¤ºæ–‡å­—
                const displayType = type === 'vw' ? 'VW å€¼' : (type === 'clamp' ? 'CLAMP è¡¨è¾¾å¼' : 'å†…å®¹');
                toastText.textContent = `å·²å¤åˆ¶ ${displayType}: ${content}`;

                // 2. æ˜¾ç¤º Toast
                clearTimeout(copyTimeoutId);
                toastMessage.classList.remove('opacity-0', 'pointer-events-none');

                // 3. 1.5ç§’åéšè— Toast
                copyTimeoutId = setTimeout(() => {
                    toastMessage.classList.add('opacity-0', 'pointer-events-none');
                }, 1500);
            }).catch(err => {
                console.error('æ— æ³•å¤åˆ¶æ–‡æœ¬: ', err);
            });
        }

        // å°† copyResult å’Œ toggleTheme ç»‘å®šåˆ° window
        window.copyResult = copyResult;
        window.toggleTheme = toggleTheme;

        // --- åˆå§‹åŒ– ---

        function init() {
            loadTheme();

            const savedWidth = localStorage.getItem(DESIGN_WIDTH_KEY);
            const savedScale = localStorage.getItem(MIN_SCALE_KEY);

            let initialWidth = savedWidth ? parseFloat(savedWidth) : DEFAULT_WIDTH;
            let initialScale = savedScale ? parseFloat(savedScale) : DEFAULT_SCALE;

            designWidthInput.value = initialWidth;
            minScaleInput.value = initialScale;

            saveConfig();

            designWidthInput.addEventListener('input', updateAfterDelay);
            minScaleInput.addEventListener('input', updateAfterDelay);
        }

        function updateAfterDelay() {
            clearTimeout(updateTimeout);
            updateTimeout = setTimeout(saveConfig, 300);
        }

        init();
    </script>
</body>

</html>